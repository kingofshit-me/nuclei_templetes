# 权限绕过漏洞

> 权限绕过（Authorization Bypass）是一类严重的安全漏洞，它允许攻击者执行未被授权的操作或访问未被授权的数据。这类漏洞的根本原因在于应用程序未能正确地实施或验证用户的权限。

## 简介

权限绕过漏洞可以表现为多种形式，包括但不限于：

- **水平权限绕过**：攻击者可以访问属于其他同级别用户的资源（例如，用户 A 访问用户 B 的订单）。
- **垂直权限绕过**：低权限用户可以访问高权限（如管理员）的功能或资源。
- **认证绕过**：攻击者在完全未经认证的情况下，直接访问需要登录后才能使用的功能。
- **业务逻辑漏洞**：利用应用程序流程中的缺陷绕过权限检查。

本目录收录了多种权限绕过漏洞的真实案例和检测模板。

---

## 八、典型漏洞 YAML 文件分析

以下对本目录中部分典型的权限绕过漏洞 YAML 文件进行详细解读。

### 1. CVE-2023-46747.yaml (F5 BIG-IP 认证绕过 RCE)
- **漏洞类型**：认证绕过 & 请求走私 (Request Smuggling)
- **漏洞原理**：
  该漏洞源于 F5 BIG-IP 的流量管理用户界面（TMUI）在处理 AJP 协议（一种用于 Web 服务器与应用服务器通信的协议）时存在缺陷。攻击者可以通过构造一个畸形的 HTTP 请求（包含 `Transfer-Encoding: chunked, chunked`），将恶意的 AJP 请求"走私"到后端。这个被走私的请求会被后端服务错误地处理，从而绕过认证检查，允许攻击者执行任意管理操作，例如创建恶意用户、执行系统命令等，最终导致远程代码执行。
- **探测原理**：
  该 YAML 模板首先通过 AJP 请求走私技术，在无需认证的情况下创建一个随机用户名的管理员账户。接着，它会尝试使用新创建的账户密码进行登录，获取认证 `token`，并最终使用该 `token` 执行 `id` 命令。如果命令成功执行并返回 `uid=` 等信息，则确认漏洞存在。
- **修复建议**：立即升级 F5 BIG-IP 至官方补丁版本，或根据 F5 官方指导采取临时缓解措施。

### 2. nacos-auth-bypass.yaml (Nacos 认证绕过)
- **漏洞类型**：未授权访问
- **漏洞原理**：
  Nacos 在某些版本中，即使启用了认证功能，由于服务器在处理请求时对 `User-Agent` 的校验逻辑存在缺陷，攻击者可以通过在请求头中设置特定的 `User-Agent`（例如，`Nacos-Server`）来伪装成服务端节点，从而绕过认证机制，直接访问需要授权的 API 接口，如用户列表接口。
- **探测原理**：
  该模板向 `/nacos/v1/auth/users` 接口发送一个 GET 请求，并在请求头中添加 `serverIdentity: security` 或类似的标识。如果响应成功（HTTP 200）并返回了包含用户列表（如 `username`, `password` 字段）的 JSON 数据，则证明认证被成功绕过。
- **修复建议**：升级 Nacos 至最新安全版本，并确保认证配置正确生效。

---

#### 总结
权限绕过是由于访问控制逻辑不严谨导致的。无论是由于协议解析差异（如 AJP 走私）还是由于不安全的默认配置或校验逻辑缺陷（如 Nacos），其核心都是"信任了不该信任的输入"。防御措施包括：
- **默认拒绝**：采用白名单机制，默认拒绝所有访问，仅对明确授权的操作放行。
- **纵深防御**：在多层进行权限校验，而不是仅仅依赖于前端或网关的单点检查。
- **逻辑严谨**：仔细审查认证和授权的每一个环节，特别是处理特殊请求头、协议转换的场景。
- **最小权限原则**：确保每个组件和服务都只拥有其完成任务所必需的最小权限。 