# 偏侵入性测试模板库

> 本目录包含用于检测和验证各类安全漏洞的偏侵入性测试模板。这些模板主要用于安全评估、渗透测试和漏洞验证。

## 目录

- [模板概述](#模板概述)
- [漏洞类型统计](#漏洞类型统计)
- [影响范围分析](#影响范围分析)
- [使用说明](#使用说明)
- [最佳实践](#最佳实践)
- [免责声明](#免责声明)

## 模板概述

本目录包含超过150个针对各类Web应用、网络设备和工业控制系统的安全测试模板。这些模板主要用于检测已知漏洞，帮助安全团队评估系统安全性。

### 主要特点

- **全面覆盖**：涵盖从2015年到2024年的多个CVE漏洞
- **多样化目标**：支持Web应用、网络设备、工业控制系统等多种环境
- **即用性强**：提供开箱即用的检测脚本，支持主流安全工具
- **持续更新**：定期添加新发现的漏洞检测模板

## 漏洞类型统计

### 1. 按漏洞类型分布

| 漏洞类型 | 数量 | 代表模板 |
|---------|------|----------|
| 远程代码执行 (RCE) | 45+ | `apache-solr-rce.yaml`, `gitlab-rce.yaml` |
| 文件上传漏洞 | 30+ | `dahua-bitmap-fileupload.yaml`, `hikvision-ivms-file-upload-rce.yaml` |
| 认证绕过 | 15+ | `casdoor-unauth-operations.yaml`, `panabit-default-login.yaml` |
| 信息泄露 | 25+ | `CVE-2023-22518.yaml`, `CVE-2022-22965.yaml` |
| 反序列化漏洞 | 10+ | `CVE-2021-44228.yaml` (Log4Shell) |
| 配置错误 | 8+ | `navidrome-admin-install.yaml` |
| 其他 | 20+ | 各种特定于应用的漏洞 |

### 2. 按目标系统分类

#### Web应用框架
- **Apache系列**
  - Apache Solr RCE (CVE-2019-17506)
  - Apache Struts2 漏洞 (CVE-2017-5638)
  - Apache HTTPd 路径遍历 (CVE-2021-41773)

- **WordPress 插件**
  - 文件上传漏洞 (多个CVE)
  - 未授权访问
  - SQL注入

- **其他CMS**
  - Drupal (CVE-2018-7600)
  - Joomla (CVE-2023-23752)
  - vBulletin (CVE-2019-16759)

#### 网络设备
- **防火墙**
  - Fortinet FortiOS (CVE-2024-55591)
  - Palo Alto PAN-OS (CVE-2024-3400)
  - WatchGuard (多个CVE)

- **路由器/交换机**
  - Cisco 设备 (多个CVE)
  - D-Link 路由器 (CVE-2019-17506)
  - TP-Link 设备 (多个CVE)

#### 工业控制系统
- **SCADA系统**
  - 西门子设备 (多个CVE)
  - 施耐德电气 (CVE-2022-45788)
  - 罗克韦尔自动化 (CVE-2023-29464)

- **PLC设备**
  - 西门子 S7-1200 (CVE-2022-38465)
  - 三菱电机 (CVE-2021-20595)

## 影响范围分析

### 1. 按CVSS评分

| 严重程度 | CVSS 范围 | 数量 | 占比 |
|---------|-----------|------|------|
| 严重 | 9.0-10.0 | 65+ | ~43% |
| 高危 | 7.0-8.9 | 45+ | ~30% |
| 中危 | 4.0-6.9 | 30+ | ~20% |
| 低危 | 0.1-3.9 | 10+ | ~7% |

### 2. 按影响年份

| 年份 | 新增漏洞数 | 代表漏洞 |
|------|-----------|----------|
| 2024 | 15+ | CVE-2024-55591, CVE-2024-55956 |
| 2023 | 40+ | CVE-2023-34362 (MOVEit), CVE-2023-22515 |
| 2022 | 35+ | CVE-2022-22965 (Spring4Shell) |
| 2021 | 25+ | CVE-2021-44228 (Log4Shell) |
| 2020及以前 | 35+ | CVE-2020-14882 (WebLogic) |

### 3. 受影响行业

- **金融行业**：银行系统、支付网关、交易平台
- **制造业**：工业控制系统、SCADA系统
- **政府机构**：政务系统、公共服务平台
- **教育机构**：校园网、在线学习平台
- **医疗健康**：医疗信息系统、医疗设备
- **电信运营商**：网络设备、计费系统

## 使用说明

### 环境要求

1. **基础工具**
   - Nuclei v2.9.0 或更高版本
   - Go 1.19+（用于编译模板）
   - Python 3.6+（部分模板需要）

2. **安装指南**
   ```bash
   # 安装最新版Nuclei
   go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
   
   # 验证安装
   nuclei -version
   ```

### 基础使用

1. **单个目标测试**
   ```bash
   # 测试单个漏洞
   nuclei -t CVE-2023-22515.yaml -u https://target.com -o results.txt
   
   # 测试整个目录下的模板
   nuclei -t ./ -u https://target.com -o results.txt
   ```

2. **批量目标测试**
   ```bash
   # 从文件读取目标列表
   nuclei -t ./ -l targets.txt -o results.txt
   ```

### 高级配置

1. **性能调优**
   ```bash
   # 设置并发数（默认25）
   -c 50
   
   # 设置超时（秒）
   -timeout 10
   
   # 设置重试次数
   -retries 3
   
   # 限制请求速率（每秒请求数）
   -rate-limit 150
   ```

2. **输出选项**
   ```bash
   # 指定输出格式（json/markdown）
   -o results.json -json
   
   # 详细输出
   -v
   
   # 仅显示确认的漏洞
   -silent
   ```

3. **模板过滤**
   ```bash
   # 按严重性过滤
   -severity critical,high
   
   # 按作者过滤
   -author "security-research"
   
   # 按标签过滤
   -tags cve,cve2023
   ```

## 最佳实践

### 1. 测试环境准备

- **隔离环境**：在隔离的测试环境中验证模板
- **备份数据**：测试前备份目标系统数据
- **监控资源**：监控系统资源使用情况

### 2. 测试执行策略

- **分阶段测试**：先进行信息收集，再进行漏洞验证
- **限制影响**：使用`-rate-limit`限制请求速率
- **避开高峰期**：避免在业务高峰期执行测试

### 3. 结果分析

- **误报验证**：手动验证关键发现
- **影响评估**：评估漏洞的实际影响
- **修复建议**：为每个确认的漏洞提供修复建议

## 免责声明

### 法律声明

本模板库仅限用于合法授权的安全测试活动。未经授权对系统进行扫描或测试可能违反以下法律法规：

- 《中华人民共和国网络安全法》
- 《中华人民共和国刑法》
- 《中华人民共和国计算机信息系统安全保护条例》
- 其他适用法律法规

### 使用限制

使用本模板库即表示您同意：

1. 仅在获得明确书面授权的情况下使用
2. 遵守所有适用的法律法规
3. 对使用本模板库造成的任何后果承担全部责任
4. 不得用于非法目的或恶意攻击

### 免责条款

- 本模板库按"原样"提供，不提供任何明示或暗示的保证
- 作者不对使用本模板库导致的任何直接或间接损失负责
- 使用者应自行承担使用风险

## 支持与贡献

### 报告问题

发现模板问题或需要新增漏洞检测模板，请提交Issue：

1. 提供详细的复现步骤
2. 包含相关日志或截图
3. 说明期望的结果和实际结果

### 贡献指南

欢迎提交Pull Request贡献新模板或改进现有模板：

1. **模板规范**
   - 遵循Nuclei模板规范
   - 包含详细的元数据（ID、Info、Reference等）
   - 添加适当的标签和分类

2. **测试要求**
   - 在提交前测试模板的功能
   - 确保不会产生过多误报
   - 提供测试用例和预期结果

3. **文档要求**
   - 更新相关文档
   - 添加使用示例
   - 说明适用版本和配置

## 资源链接

### 官方资源
- [Nuclei 官方文档](https://nuclei.projectdiscovery.io/)
- [Nuclei 模板指南](https://nuclei.projectdiscovery.io/docs/templating-guide/)
- [Nuclei GitHub](https://github.com/projectdiscovery/nuclei)

### 漏洞数据库
- [CVE 数据库](https://cve.mitre.org/)
- [NVD 国家漏洞数据库](https://nvd.nist.gov/)
- [Exploit Database](https://www.exploit-db.com/)
- [Vulners](https://vulners.com/)

### 安全社区
- [HackerOne](https://www.hackerone.com/)
- [Bugcrowd](https://www.bugcrowd.com/)
- [安全客](https://www.anquanke.com/)
- [Seebug](https://www.seebug.org/)

* [Yakit - 安全研究者的瑞士军刀](https://github.com/yaklang/yakit)
* [Goby - 新一代网络安全测试工具](https://github.com/gobysec/Goby)

---

## 八、典型漏洞 YAML 文件分析

本目录中的模板多为具有一定侵入性的漏洞验证，通常涉及文件上传、远程代码执行等高危操作。以下对部分典型 YAML 文件进行解读。

### 1. yonyou-nc-dispatcher-fileupload.yaml (用友 NC 文件上传)
- **漏洞类型**：反序列化 & 任意文件上传
- **漏洞原理**：
  用友 NC 产品的 `ServiceDispatcherServlet` 接口在处理传入的数据时存在反序列化漏洞。攻击者可以构造一个恶意的、序列化的数据流，该数据流在被服务器端反序列化时，会触发一个文件上传操作，从而将任意文件（如 JSP Webshell）写入到服务器的 Web 目录下。
- **探测原理**：
  该模板首先向 `/ServiceDispatcherServlet` 接口发送一个预先构造好的十六进制 payload，这个 payload 就是一个序列化的数据包，其内容是在服务器的 `/ncupload/` 目录下写入一个名为 `n2d19a.jsp` 的 Webshell。接着，模板会立即访问这个刚刚上传的 JSP 文件。如果能够成功访问（HTTP 200）并且页面内容包含预期的测试字符串（`just_a_test`），则证明文件上传成功，漏洞存在。
- **修复建议**：升级用友 NC 至最新版本，或为 `ServiceDispatcherServlet` 接口添加严格的访问控制和认证。

### 2. ecology-arbitrary-file-upload.yaml (泛微 OA 文件上传)
- **漏洞类型**：任意文件上传
- **漏洞原理**：
  泛微 OA 的 `uploadOperation.jsp` 页面在处理文件上传时，未对上传文件的类型、内容和路径进行充分的校验。这使得攻击者可以绕过安全限制，直接上传恶意的 JSP 脚本文件到服务器的指定目录（`/page/exportImport/fileTransfer/`）。
- **探测原理**：
  该模板构造一个 `multipart/form-data` 类型的 POST 请求，直接向 `/page/exportImport/uploadOperation.jsp` 上传一个随机命名的 JSP 文件。该 JSP 文件的内容是一个计算表达式（`<%out.print(364536*876356);%>`）和一个自删除操作。上传后，模板会立刻访问这个 JSP 文件，如果响应中包含了该表达式的计算结果（`319463310816`），则确认 Webshell 已被成功执行，漏洞存在。
- **修复建议**：对所有文件上传功能点增加严格的白名单过滤，禁止上传脚本文件，并校验文件内容和上传路径。

---

#### 总结
侵入性测试模板直接模拟了攻击者的真实攻击路径，其特点是：
- **高风险、高回报**：成功利用通常意味着获得了服务器的控制权。
- **验证精确**：通过"写文件再验证"或"执行命令看回显"的方式，可以非常精确地判断漏洞是否存在，误报率低。
- **需谨慎使用**：由于会真实地在目标系统上创建文件或执行命令，在未经授权的情况下使用这些模板是绝对禁止的。

分析这些模板有助于理解真实世界中高危漏洞的利用方式，并指导开发人员如何从根源上修复漏洞，例如：增强反序列化过程的安全性、加固文件上传的每一个环节等。
